# Render Blueprint for Food Fiesta Microservices
# All services deploy simultaneously with pre-configured URLs

services:
  # Identity Service - User & Agent authentication
  - type: web
    name: food-fiesta-identity
    runtime: node
    buildCommand: cd backend/identity-service && npm install
    startCommand: cd backend/identity-service && npm start
    plan: free
    envVars:
      - key: PORT
        value: 10000
      - key: MONGO_URI
        sync: false
      - key: JWT_SECRET
        generateValue: true
      - key: NODE_ENV
        value: production

  # Order Service - Restaurants, Menu, Orders
  - type: web
    name: food-fiesta-orders
    runtime: node
    buildCommand: cd backend/order-service && npm install
    startCommand: cd backend/order-service && npm start
    plan: free
    envVars:
      - key: PORT
        value: 10000
      - key: MONGO_URI
        sync: false
      - key: NODE_ENV
        value: production

  # Gateway Service - API Gateway (proxies to other services)
  - type: web
    name: food-fiesta-gateway
    runtime: node
    buildCommand: cd backend/gateway && npm install
    startCommand: cd backend/gateway && npm start
    plan: free
    envVars:
      - key: PORT
        value: 10000
      - key: IDENTITY_SERVICE_URL
        value: https://food-fiesta-identity.onrender.com
      - key: ORDER_SERVICE_URL
        value: https://food-fiesta-orders.onrender.com
      - key: NODE_ENV
        value: production

  # Frontend - React UI
  - type: web
    name: food-fiesta-frontend
    runtime: node
    # Use 'npm install' to ensure Vite is installed
    buildCommand: cd frontend && npm install && npm run build
    # Point 'serve' to the 'dist' folder created by Vite
    startCommand: cd frontend && npx serve -s dist -l $PORT
    plan: free
    envVars:
      - key: VITE_API_URL
        value: https://food-fiesta-gateway.onrender.com/api
      - key: NODE_ENV
        value: production

